#!/bin/bash

# Pre-installation script for RemoteCompanion
# Creates necessary directory structure for both rootless and rootful jailbreaks

set -e

# Determine if this is a rootless or rootful jailbreak
if [ -L "/var/jb" ]; then
    # Standard Rootless (Palera1n, Dopamine, etc. use symlink)
    IS_ROOTLESS=1
    APP_DIR="/var/jb/Applications"
    echo "RemoteCompanion: Detected rootless jailbreak"
else
    # Rootful or legacy jailbreak
    IS_ROOTLESS=0
    APP_DIR="/Applications"
    echo "RemoteCompanion: Detected rootful (legacy) jailbreak"
fi

# Create the Applications directory if it doesn't exist
if [ ! -d "$APP_DIR" ]; then
    echo "RemoteCompanion: Creating $APP_DIR"
    mkdir -p "$APP_DIR"
    chmod 755 "$APP_DIR"
fi

# Create the RemoteCompanion.app directory if it doesn't exist
if [ ! -d "$APP_DIR/RemoteCompanion.app" ]; then
    echo "RemoteCompanion: Creating $APP_DIR/RemoteCompanion.app"
    mkdir -p "$APP_DIR/RemoteCompanion.app"
    chmod 755 "$APP_DIR/RemoteCompanion.app"
fi

echo "RemoteCompanion: Pre-installation setup complete"
exit 0
